---
import Card from "./Card.astro";
import {GLOBAL_STYLE} from "@/consts";
import "@/styles/components.scss";
import '@/styles/global.scss';
import type { UnifiedPost } from '@/types/post';

interface Props extends UnifiedPost {}

const {slug, heroImage, title, pubDate, description, source} = Astro.props;

// URLを生成（microCMSの場合は専用のパスを使用）
const postUrl = source === 'microcms' ? `/blog/cms/${slug.replace('microcms-', '')}` : `/blog/${slug}`;
---

<Card
    class="post-card"
    variant={GLOBAL_STYLE}
>
    <a
        class='img-container'
        href={postUrl}
    >
        {
            heroImage === undefined ?
                (
                    <h4 class="emphasize">
                        {title}
                    </h4>
                )
                : <img src={heroImage} alt={title} loading="lazy"/>
        }
    </a>
    <h4>
        <a class="link" href={postUrl}>
            {title}
        </a>
    </h4>
    <p>
        {description}
    </p>
    <div class="post-meta">
        <p class="date">
            {pubDate.toLocaleDateString()}
        </p>
        <span class={`source-badge ${source}`}>
            {source === 'microcms' ? 'CMS' : 'MD'}
        </span>
    </div>
</Card>

<style lang="scss">
    @use "../styles/colors.scss";

    .post-card {
        padding-bottom: 2rem;

        & > h4 {
            margin-top: 1rem;
        }
    }

    .post-meta {
        position: absolute;
        bottom: 0.875rem;
        right: 0.875rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .date {
        font-size: 0.875rem;
        margin: 0;
    }

    .source-badge {
        font-size: 0.75rem;
        padding: 0.125rem 0.375rem;
        border-radius: 0.25rem;
        font-weight: bold;
        text-transform: uppercase;

        &.markdown {
            background-color: colors.$color-primary-100;
            color: colors.$color-primary-700;
        }

        &.microcms {
            background-color: colors.$color-slate-200;
            color: colors.$color-slate-700;
        }
    }

    .img-container {
        aspect-ratio: 16/9;
        overflow: clip;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 0.75rem;
        cursor: pointer;

        img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        & > * {
            transition: transform 0.3s ease-in-out;
        }

        & > *:hover {
            transform: scale(1.2);
        }

        &:has(h4) {
            background-color: rgba(colors.$color-slate-100, 0.5);
        }

        h4 {
            wrap-option: wrap;
        }
    }
</style>